<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Short Link Service</title>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'pingfang SC', 'helvetica neue', arial, 'hiragino sans gb', 'microsoft yahei ui', 'microsoft yahei', simsun, sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      color: #333;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .wrapper {
      background: #fff;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      border-radius: 16px;
      padding: 40px;
      min-width: 580px;
      max-width: 680px;
      width: 100%;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .wrapper::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background: linear-gradient(90deg, #4776E6, #8E54E9);
    }

    .github-link {
      position: absolute;
      top: 16px;
      right: 16px;
      text-decoration: none;
      font-size: 14px;
      color: #6c5ce7;
      border: 1px solid #6c5ce7;
      padding: 8px 16px;
      border-radius: 50px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .github-link:hover {
      background: #6c5ce7;
      color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(108, 92, 231, 0.2);
    }

    .github-link svg {
      width: 16px;
      height: 16px;
    }

    header {
      font-size: 36px;
      margin-bottom: 30px;
      color: #2d3436;
      font-weight: 700;
      position: relative;
      display: inline-block;
    }

    header::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 4px;
      background: linear-gradient(90deg, #4776E6, #8E54E9);
      border-radius: 2px;
    }

    .url-wrapper {
      margin-top: 24px;
      position: relative;
    }

    .input-container {
      position: relative;
      margin-bottom: 16px;
    }

    .input-container svg {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-90%);
      width: 20px;
      height: 20px;
      color: #a0a0a0;
    }

    input[type="text"] {
      width: 100%;
      padding: 14px 14px 14px 44px;
      margin-bottom: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 16px;
      transition: all 0.3s ease;
      background-color: #f9f9f9;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #6c5ce7;
      box-shadow: 0 0 0 4px rgba(108, 92, 231, 0.15);
      background-color: #fff;
    }

    input[type="button"] {
      width: 100%;
      padding: 14px;
      background: linear-gradient(90deg, #4776E6, #8E54E9);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(108, 92, 231, 0.2);
    }

    input[type="button"]:hover {
      background: linear-gradient(90deg, #3d68d8, #7c48d5);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(108, 92, 231, 0.3);
    }

    input[type="button"]:active {
      transform: translateY(0);
      box-shadow: 0 2px 5px rgba(108, 92, 231, 0.2);
    }

    .response {
      margin-top: 24px;
      font-size: 16px;
      color: #28a745;
      padding: 20px;
      border-radius: 12px;
      background-color: rgba(40, 167, 69, 0.05);
      border: 1px solid rgba(40, 167, 69, 0.2);
      display: none;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    .response.error {
      color: #e74c3c;
      background-color: rgba(231, 76, 60, 0.05);
      border: 1px solid rgba(231, 76, 60, 0.2);
    }

    .short-link-card {
      margin-top: 16px;
      padding: 16px;
      background-color: #f8f9fa;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      text-align: left;
      display: flex;
      flex-direction: column;
      gap: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    .short-link-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }

    .short-link-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 4px;
    }

    .short-link-value {
      font-size: 16px;
      color: #6c5ce7;
      font-weight: 600;
      word-break: break-all;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .response.visible {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    .response a {
      color: #6c5ce7;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .response a:hover {
      text-decoration: underline;
      color: #4834d4;
    }

    @media screen and (max-width: 520px) {
      body {
        padding: 16px;
        align-items: flex-start;
      }

      .wrapper {
        padding: 30px 20px;
        width: 100%;
        min-width: 0;
        border-radius: 12px;
      }

      header {
        font-size: 28px;
      }
    }

    .loading {
      display: none;
      margin-top: 16px;
      font-size: 14px;
      color: #6c5ce7;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    /* 确保加载状态显示时是flex布局 */
    .loading.active {
      display: flex;
    }

    .loading-spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(108, 92, 231, 0.3);
      border-radius: 50%;
      border-top-color: #6c5ce7;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .action-buttons {
      margin-top: 16px;
      display: none;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: 10px 16px;
      background: #6c5ce7;
      color: #fff;
      border: none;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 4px 8px rgba(108, 92, 231, 0.2);
    }

    .action-btn:hover {
      background: #4834d4;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(108, 92, 231, 0.3);
    }

    .action-btn:active {
      transform: translateY(0);
    }

    .action-btn.share {
      background: #00b894;
      box-shadow: 0 4px 8px rgba(0, 184, 148, 0.2);
    }

    .action-btn.share:hover {
      background: #00a382;
      box-shadow: 0 6px 12px rgba(0, 184, 148, 0.3);
    }

    .action-btn .share-btn-text {
      display: inline-block;
      transition: all 0.3s ease;
    }

    .action-btn.share-success {
      background: #00a382;
    }

    .share-animation {
      animation: pulse 0.5s ease;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
      }
    }

    .action-btn.qrcode {
      background: #0984e3;
      box-shadow: 0 4px 8px rgba(9, 132, 227, 0.2);
    }

    .action-btn.qrcode:hover {
      background: #0876cc;
      box-shadow: 0 6px 12px rgba(9, 132, 227, 0.3);
    }

    .action-btn.stats {
      background: #e17055;
      box-shadow: 0 4px 8px rgba(225, 112, 85, 0.2);
    }

    .action-btn.stats:hover {
      background: #d65f45;
      box-shadow: 0 6px 12px rgba(225, 112, 85, 0.3);
    }

    .btn-icon {
      width: 16px;
      height: 16px;
    }

    /* QR Code Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #fff;
      padding: 24px;
      border-radius: 16px;
      max-width: 90%;
      width: 320px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      position: relative;
      text-align: center;
    }

    .modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      cursor: pointer;
      font-size: 20px;
      color: #666;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background-color: #f0f0f0;
      color: #333;
    }

    .qrcode-container {
      margin: 16px 0;
      display: flex;
      justify-content: center;
    }

    .qrcode-img {
      max-width: 200px;
      max-height: 200px;
    }
  </style>
</head>

<body>
  <div class="wrapper" role="main">
    <a href="https://www.foxccs.cn" class="github-link" target="_blank">
      <svg t="1750756700268" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1996" width="200" height="200"><path d="M517.77536 972.8c133.98016-30.19776 211.70176-70.42048 301.2608-156.3136 29.32736-28.11904 174.04928-63.68256 190.4128-100.83328 23.72608-53.8624-58.2144-115.72224-58.2144-178.40128 0-240.54784-194.06848-435.5584-433.4592-435.5584-239.38048 0-433.44896 195.01056-433.44896 435.5584 0 68.21888-86.13888 124.14976-58.3168 181.62688 15.28832 31.56992 164.1472 73.216 189.51168 97.60768C305.08032 902.68672 383.55968 942.60224 517.77536 972.8z" fill="#FFD797" p-id="1997"></path><path d="M908.77952 65.5872c-0.88064 1.40288 79.0528 276.7872 32.68608 379.32032a439.0912 439.0912 0 0 1 9.76896 92.34432c0 62.6688 81.94048 124.54912 58.2144 178.40128-1.71008 3.8912-4.88448 7.74144-9.216 11.55072-146.59584-39.44448-297.6768-4.31104-453.25312 105.41056l-5.64224 4.00384H494.592C336.24064 723.2 182.55872 686.92992 33.536 727.78752c-3.54304-3.0208-6.11328-5.9904-7.5264-8.9088-27.82208-57.47712 58.3168-113.408 58.3168-181.62688 0-27.4944 2.53952-54.39488 7.38304-80.47616-59.62752-90.97216 27.136-389.7344 26.22464-391.18848 81.39776-14.41792 159.06816 8.76544 233.03168 69.5296a430.40768 430.40768 0 0 1 166.8096-33.42336 430.44864 430.44864 0 0 1 160.94208 31.01696C751.77984 73.728 828.4672 51.36384 908.77952 65.5872z" fill="#FF6F24" p-id="1998"></path><path d="M283.1872 315.51488c31.10912-104.9088-23.97184-186.24512-165.25312-244.0192 1.024 1.65888-77.7216 340.93056 28.89728 383.11936-3.51232 2.92864 41.94304-43.42784 136.35584-139.10016z m461.48608 0c-31.10912-104.9088 23.97184-186.24512 165.24288-244.0192-1.024 1.65888 77.7216 340.93056-28.89728 383.11936 3.52256 2.92864-41.9328-43.42784-136.3456-139.10016z" fill="#922101" opacity=".574" p-id="1999"></path><path d="M647.69024 629.00224c-0.21504-60.29312 44.56448-83.94752 134.3488-70.95296-2.78528 3.072 6.78912 44.93312-40.51968 69.15072-11.264 5.76512-42.53696 6.36928-93.82912 1.80224z m-251.46368 0c0.22528-60.29312-44.55424-83.94752-134.33856-70.95296 2.78528 3.072-6.79936 44.93312 40.50944 69.15072 11.264 5.76512 42.53696 6.36928 93.82912 1.80224z" fill="#350000" p-id="2000"></path><path d="M743.10656 565.72928l0.04096 0.1536c0.78848 3.42016 1.20832 6.99392 1.20832 10.6496 0 23.4496-17.14176 42.82368-39.424 46.00832-3.42016 0.1536-7.2192 0.21504-11.39712 0.18432a45.93664 45.93664 0 0 1-36.7104-26.61376c10.25024-24.832 39.0144-34.95936 86.28224-30.38208z m-459.84768 0l-0.04096 0.1536a47.13472 47.13472 0 0 0-1.20832 10.6496c0 23.4496 17.14176 42.82368 39.424 46.00832 3.40992 0.1536 7.2192 0.21504 11.39712 0.18432a45.93664 45.93664 0 0 0 36.7104-26.61376c-10.26048-24.832-39.0144-34.95936-86.28224-30.38208z" fill="#923320" p-id="2001"></path><path d="M328.6528 574.72c-4.12672 10.24-6.25664 17.43872-6.38976 21.58592-0.23552 6.89152 1.8944 12.5952 6.38976 17.1008 0.768 0.54272 6.44096-5.30432 6.144-17.87904-0.1024-3.72736-2.1504-10.6496-6.144-20.80768z m372.72576 0c-4.12672 10.24-6.2464 17.43872-6.38976 21.58592-0.22528 6.89152 1.90464 12.5952 6.38976 17.1008 0.77824 0.54272 6.44096-5.30432 6.144-17.87904-0.09216-3.72736-2.14016-10.6496-6.144-20.80768z" fill="#FFFFFF" opacity=".632" p-id="2002"></path><path d="M520.42752 863.8464c37.24288 0 67.4304-27.81184 67.4304-62.1056 0-34.304-134.8608-34.304-134.8608 0s30.19776 62.1056 67.4304 62.1056z" fill="#040C12" p-id="2003"></path><path d="M520.15104 152.02304c8.86784 146.97472 40.57088 238.83776 95.10912 275.57888l2.19136 1.4336-0.24576 0.07168c-6.42048 2.53952-71.46496 73.5744-96.80896 138.2912-0.0512 0.08192-0.09216 0-0.12288-0.26624-0.04096 0.256-0.08192 0.34816-0.12288 0.26624-25.35424-64.7168-90.38848-135.75168-96.8192-138.2912l-0.24576-0.07168 2.2016-1.4336c53.71904-36.1984 85.1968-125.87008 94.45376-269.03552l0.4096-6.5536z" fill="#C74D22" p-id="2004"></path><path d="M735.15008 721.8688c49.55136 0 89.72288-17.17248 89.72288-38.3488s-40.17152-38.3488-89.72288-38.3488c-49.5616 0-89.72288 17.17248-89.72288 38.3488s40.17152 38.3488 89.72288 38.3488z m-443.89376 0c49.5616 0 89.72288-17.17248 89.72288-38.3488s-40.17152-38.3488-89.72288-38.3488-89.72288 17.17248-89.72288 38.3488 40.17152 38.3488 89.72288 38.3488z" fill="#C53028" fill-opacity=".3" p-id="2005"></path></svg>
      狐狸导航
    </a>
    <header>短链接服务</header>
    <div class="url-wrapper">
      <div class="input-container">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
        </svg>
        <input type="text" id="url-input" placeholder="输入需要缩短的链接 (http://、https:// 或 #小程序://)">
      </div>
      <input type="button" value="生成短链接" id="add-btn">
    </div>
    <div class="response" id="response-msg" aria-live="polite"></div>
    <div class="loading" id="loading-msg">
      <div class="loading-spinner"></div>
      <span>正在生成短链接...</span>
    </div>
    <div class="action-buttons" id="action-buttons">
      <button class="action-btn" id="copy-btn">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
        </svg>
        复制链接
      </button>
      <button class="action-btn share" id="share-btn">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z" />
        </svg>
        分享链接
      </button>
      <button class="action-btn qrcode" id="qrcode-btn">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M3 11h8V3H3v8zm2-6h4v4H5V5zm8-2v8h8V3h-8zm6 6h-4V5h4v4zM3 21h8v-8H3v8zm2-6h4v4H5v-4zm13-2h-3v2h3v3h2v-3h3v-2h-3v-3h-2v3z" />
        </svg>
        生成二维码
      </button>
      <button class="action-btn stats" id="stats-btn">
        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
          <path
            d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
        </svg>
        访问统计
      </button>
    </div>

    <!-- QR Code Modal -->
    <div class="modal" id="qrcode-modal">
      <div class="modal-content">
        <div class="modal-close" id="modal-close">×</div>
        <h3>短链接二维码</h3>
        <div class="qrcode-container" id="qrcode-container">
          <canvas id="qr-canvas"></canvas>
        </div>
        <p>扫描二维码访问短链接</p>
      </div>
    </div>
  </div>

  <script src="autolog.js"></script>
  <script src="https://unpkg.com/qrcode@1.5.1/build/qrcode.js"></script>
  <script>
    const urlInput = document.getElementById('url-input');
    const addBtn = document.getElementById('add-btn');
    const responseMsg = document.getElementById('response-msg');
    const loadingMsg = document.getElementById('loading-msg');
    const copyBtn = document.getElementById('copy-btn');
    const shareBtn = document.getElementById('share-btn');
    const qrcodeBtn = document.getElementById('qrcode-btn');
    const statsBtn = document.getElementById('stats-btn');
    const actionButtons = document.getElementById('action-buttons');
    const qrcodeModal = document.getElementById('qrcode-modal');
    const modalClose = document.getElementById('modal-close');
    const qrcodeContainer = document.getElementById('qrcode-container');

    // 当前生成的短链接
    let currentShortUrl = '';

    function fetchApi(url, { method = 'GET', body, params }) {
      return new Promise((resolve, reject) => {
        fetch(url, {
          method,
          headers: {
            'Content-Type': 'application/json;charset=utf-8'
          },
          params,
          body: body ? JSON.stringify(body) : undefined,
        })
          .then(res => res.json())
          .then((data) => {
            if (data.code === 200) {
              resolve(data);
            } else {
              reject(data);
            }
          }).catch((error) => {
            reject({ msg: error.message, ...error });
          })
      })
    }

    // 验证URL格式是否正确（http(s)://或#小程序://）
    function validateUrl(url) {
      const urlPattern = /^(https?:\/\/|#小程序:\/\/).+/;
      return urlPattern.test(url);
    }

    // 生成二维码
    function generateQRCode(url) {
      var canvas = document.getElementById('qr-canvas')

      QRCode.toCanvas(canvas, url, function (error) {
        if (error) console.error(error)
        console.log('success!');
      })
      qrcodeModal.style.display = 'flex';
    }

    // 分享链接 - 优化移动端兼容性
    function shareLink(url) {
      // 添加分享按钮动画效果
      const originalShareBtnHTML = shareBtn.innerHTML;
      shareBtn.innerHTML = `
        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z" />
        </svg>
        <span class="share-btn-text">分享中...</span>
      `;

      // 获取设备类型信息，用于优化分享体验
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      const isAndroid = /Android/.test(navigator.userAgent);

      // 准备分享内容，根据设备类型优化
      const shareTitle = '短链接分享';
      const shareText = isMobile ?
        '我生成了一个短链接，点击访问：' :
        '我通过短链接服务生成了一个链接，点击访问：';

      // 检测是否支持Web Share API
      if (navigator.share) {
        try {
          navigator.share({
            title: shareTitle,
            text: shareText,
            url: url
          })
            .then(() => {
              // 分享成功后添加类以改变按钮样式
              shareBtn.classList.add('share-success');
              autolog.log("分享成功", "success", 2500);
              // 分享成功后显示成功图标
              shareBtn.innerHTML = `
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg> 
                <span class="share-btn-text">已分享</span>
              `;
              // 恢复原始按钮状态
              setTimeout(() => {
                shareBtn.innerHTML = originalShareBtnHTML;
                shareBtn.classList.remove('share-success');
              }, 2000);
            })
            .catch((error) => {
              console.error('分享失败:', error);
              if (error.name === 'AbortError') {
                autolog.log("分享已取消", "info", 2500);
              } else {
                // 根据设备类型提供不同的提示
                if (isMobile) {
                  if (isIOS) {
                    autolog.log("分享失败，请尝试使用Safari浏览器", "info", 3000);
                  } else if (isAndroid) {
                    autolog.log("分享失败，请尝试使用Chrome浏览器", "info", 3000);
                  } else {
                    autolog.log("分享失败，已复制链接到剪贴板", "info", 3000);
                  }
                } else {
                  autolog.log("分享失败，已复制链接到剪贴板", "info", 3000);
                }
                // 如果分享API失败，回退到剪贴板复制
                fallbackToCopy(url);
              }
              // 恢复原始按钮状态
              shareBtn.innerHTML = originalShareBtnHTML;
            });
        } catch (error) {
          console.error('分享API错误:', error);
          // 根据设备类型提供不同的错误提示
          if (isMobile) {
            autolog.log("分享功能不可用，已复制链接", "info", 3000);
          } else {
            autolog.log("此浏览器不支持分享功能，已复制链接", "info", 3000);
          }
          // 出现异常时回退到剪贴板复制
          fallbackToCopy(url);
          shareBtn.innerHTML = originalShareBtnHTML;
        }
      } else {
        // 如果浏览器不支持原生分享API，根据设备类型提供不同的提示
        if (isMobile) {
          autolog.log("您的浏览器不支持直接分享，已复制链接", "info", 3000);
        } else {
          autolog.log("PC端不支持直接分享，已复制链接到剪贴板", "info", 3000);
        }
        // 复制到剪贴板
        fallbackToCopy(url);
        shareBtn.innerHTML = originalShareBtnHTML;
      }
    }

    // 复制到剪贴板的回退方案
    function fallbackToCopy(url) {
      try {
        // 尝试使用现代Clipboard API
        navigator.clipboard.writeText(url)
          .then(() => {
            autolog.log("链接已复制到剪贴板，请手动分享", "success", 3000);
          })
          .catch((err) => {
            console.error('Clipboard API失败，尝试备用方法:', err);
            // 如果Clipboard API失败，使用传统方法
            fallbackLegacyCopy(url);
          });
      } catch (error) {
        console.error('剪贴板复制失败:', error);
        // 如果出现异常，使用传统方法
        fallbackLegacyCopy(url);
      }
    }

    // 使用传统方法复制到剪贴板
    function fallbackLegacyCopy(url) {
      try {
        // 创建一个临时输入框来复制
        const tempInput = document.createElement('input');
        tempInput.value = url;
        tempInput.style.position = 'fixed';
        tempInput.style.opacity = '0';
        document.body.appendChild(tempInput);
        tempInput.focus();
        tempInput.select();

        const successful = document.execCommand('copy');
        document.body.removeChild(tempInput);

        if (successful) {
          autolog.log("链接已复制，请手动分享", "success", 3000);
        } else {
          autolog.log("复制失败，请手动复制链接", "error", 3000);
        }
      } catch (err) {
        console.error('传统复制方法失败:', err);
        autolog.log("无法复制链接，请手动复制", "error", 3000);
      }
    }

    // 重置复制按钮文本
    function resetCopyButton() {
      setTimeout(() => {
        copyBtn.innerHTML = `
          <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
          </svg>
          复制链接
        `;
      }, 2000);
    }

    // 关闭模态框
    modalClose.addEventListener('click', () => {
      qrcodeModal.style.display = 'none';
    });

    // 点击模态框外部关闭
    window.addEventListener('click', (event) => {
      if (event.target === qrcodeModal) {
        qrcodeModal.style.display = 'none';
      }
    });

    // 复制按钮点击事件
    copyBtn.addEventListener('click', () => {
      if (currentShortUrl) {
        navigator.clipboard.writeText(currentShortUrl);
        autolog.log("复制成功", "success", 2500);
        // 添加复制按钮动画效果
        copyBtn.innerHTML = `
          <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg> 
          已复制
        `;
        resetCopyButton();
      } else {
        autolog.log("没有可复制的短链接", "error", 2500);
      }
    });

    // 分享按钮点击事件
    shareBtn.addEventListener('click', () => {
      if (currentShortUrl) {
        // 添加点击动画效果
        shareBtn.classList.add('share-animation');
        setTimeout(() => {
          shareBtn.classList.remove('share-animation');
        }, 500);
        shareLink(currentShortUrl);
      } else {
        autolog.log("没有可分享的短链接", "error", 2500);
      }
    });

    // 二维码按钮点击事件
    qrcodeBtn.addEventListener('click', () => {
      if (currentShortUrl) {
        generateQRCode(currentShortUrl);
      } else {
        autolog.log("没有可生成二维码的短链接", "error", 2500);
      }
    });

    // 统计按钮点击事件
    statsBtn.addEventListener('click', () => {
      if (currentShortUrl) {
        autolog.log("访问统计功能即将上线", "info", 3000);
      } else {
        autolog.log("没有可查看统计的短链接", "error", 2500);
      }
    });

    // 生成短链接
    addBtn.addEventListener('click', () => {
      const inputUrl = urlInput.value.trim();
      if (!inputUrl) {
        autolog.log('请输入链接', 'error', 3000);
        return;
      }

      if (!validateUrl(inputUrl)) {
        autolog.log('请输入有效的链接，必须以 http://、https:// 或 #小程序:// 开头', 'error', 3000);
        return;
      }

      // 隐藏之前的短链接展示区域
      responseMsg.textContent = '';
      responseMsg.classList.remove('visible');
      // 显示加载状态
      loadingMsg.style.display = 'none';
      loadingMsg.classList.add('active');
      loadingMsg.style.display = 'flex';

      fetchApi('/api/addUrl', { method: 'POST', body: { url: urlInput.value } })
        .then((data) => {
          // 隐藏加载状态
          loadingMsg.style.display = 'none';
          loadingMsg.classList.remove('active');

          // 设置当前短链接
          currentShortUrl = window.location.origin + data.url;

          // 使用autolog显示成功消息
          autolog.log("短链接生成成功", "success", 3000);

          // 清空输入框
          urlInput.value = '';

          // 创建短链接卡片
          responseMsg.innerHTML = `
            <div class="short-link-card">
              <div class="short-link-label">短链接地址</div>
              <div class="short-link-value">
                <a href="${currentShortUrl}" target="_blank">${currentShortUrl}</a>
              </div>
            </div>
          `;
          responseMsg.classList.remove('error');
          responseMsg.classList.add('visible');

          // 显示功能按钮组
          actionButtons.style.display = 'flex';
        })
        .catch((error) => {
          loadingMsg.style.display = 'none';
          loadingMsg.classList.remove('active');
          autolog.log(`发生错误: ${error.msg}`, "error", 3500);
          responseMsg.textContent = '';
          responseMsg.classList.remove('visible');
          actionButtons.style.display = 'none';
          // 清空当前短链接
          currentShortUrl = '';
        });
    });
  </script>
</body>

</html>
